<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Study Routine</title>
    <style>
        :root {
            --primary-color: #4a6bff;
            --secondary-color: #ff6b6b;
            --accent-color: #6bff6b;
            --dark-color: #333;
            --light-color: #f5f5f5;
            --bg-color: #f9f9f9;
            --text-color: #333;
            --card-bg: white;
            --border-radius: 8px;
            --box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .dark-mode {
            --primary-color: #5d7dff;
            --secondary-color: #ff7b7b;
            --accent-color: #7bff7b;
            --bg-color: #121212;
            --text-color: #f0f0f0;
            --card-bg: #1e1e1e;
            --light-color: #2a2a2a;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--primary-color);
        }
        
        h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .datetime-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .datetime-box {
            flex: 1;
            min-width: 250px;
            background: linear-gradient(135deg, var(--primary-color), #6a5acd);
            color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            text-align: center;
        }
        
        .location-info {
            font-size: 0.9rem;
            margin-top: 5px;
            opacity: 0.9;
        }
        
        .timer-box {
            flex: 1;
            min-width: 250px;
            background: linear-gradient(135deg, var(--secondary-color), #ff8e8e);
            color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            text-align: center;
        }
        
        .current-time {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .current-date {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .timer-display {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .timer-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        button {
            padding: 8px 15px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .timer-btn {
            background-color: white;
            color: var(--secondary-color);
        }
        
        .timer-btn:hover {
            background-color: rgba(255, 255, 255, 0.9);
        }
        
        .routine-section {
            margin-bottom: 40px;
        }
        
        .routine-title {
            background-color: var(--primary-color);
            color: white;
            padding: 12px 20px;
            border-radius: var(--border-radius);
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
        }
        
        .routine-title h2 {
            font-size: 1.5rem;
            margin-right: 10px;
        }
        
        .edit-btn {
            background-color: white;
            color: var(--primary-color);
            padding: 5px 10px;
            font-size: 0.9rem;
        }
        
        .edit-btn:hover {
            background-color: rgba(255, 255, 255, 0.9);
        }
        
        .task-list {
            list-style: none;
            min-height: 20px;
        }
        
        .task-item {
            background-color: var(--light-color);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
            cursor: move;
        }
        
        .task-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }
        
        .task-checkbox {
            margin-right: 15px;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .task-text {
            flex: 1;
        }
        
        .completed {
            text-decoration: line-through;
            opacity: 0.7;
            background-color: rgba(107, 255, 107, 0.2);
        }
        
        .exam-section {
            background-color: var(--light-color);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-top: 30px;
            border-left: 5px solid var(--primary-color);
        }
        
        .exam-section h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .progress-container {
            margin: 20px 0;
            background-color: var(--light-color);
            border-radius: var(--border-radius);
            padding: 15px;
            text-align: center;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        .progress-text {
            font-weight: bold;
            margin-top: 5px;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .control-btn {
            padding: 8px 15px;
            border-radius: var(--border-radius);
            font-weight: bold;
        }
        
        .dark-mode-btn {
            background-color: var(--dark-color);
            color: white;
        }
        
        .export-btn {
            background-color: var(--accent-color);
            color: white;
        }
        
        .gmt-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .gmt-control select {
            padding: 5px;
            border-radius: 4px;
            border: 1px solid #ccc;
            background-color: var(--card-bg);
            color: var(--text-color);
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid var(--light-color);
            color: var(--text-color);
            opacity: 0.7;
        }
        
        @media (max-width: 768px) {
            .datetime-container {
                flex-direction: column;
            }
            
            .datetime-box, .timer-box {
                width: 100%;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .routine-title h2 {
                font-size: 1.3rem;
            }
        }
        
        /* Edit mode styles */
        .edit-mode .task-text {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-right: 10px;
        }
        
        .edit-controls {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 15px;
        }
        
        .save-btn {
            background-color: var(--accent-color);
            color: white;
        }
        
        .cancel-btn {
            background-color: #ccc;
            color: var(--dark-color);
        }
        
        .add-task-btn {
            background-color: var(--primary-color);
            color: white;
            margin-top: 10px;
            padding: 8px 15px;
        }
        
        .delete-task-btn {
            background-color: var(--secondary-color);
            color: white;
            padding: 5px 10px;
            margin-left: 10px;
            font-size: 0.8rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>🔥 My Daily Study Routine 🔥</h1>
            <p>Stay organized and track your progress</p>
        </header>
        
        <div class="controls">
            <button class="control-btn dark-mode-btn" id="dark-mode-toggle">🌙 Dark Mode</button>
            <button class="control-btn export-btn" id="export-pdf">📄 Export PDF</button>
        </div>
        
        <div class="progress-container">
            <div class="progress-text" id="progress-text">0% Completed (0/0 Tasks)</div>
            <div class="progress-bar">
                <div class="progress" id="progress-bar" style="width: 0%;"></div>
            </div>
        </div>
        
        <div class="datetime-container">
            <div class="datetime-box">
                <h3>Current Date & Time</h3>
                <div class="current-time" id="current-time">00:00:00 AM</div>
                <div class="current-date" id="current-date">Day, Month 00, 0000</div>
                <div class="location-info" id="location-info">Location: Loading...</div>
                <div class="gmt-control" id="gmt-control" style="display: none;">
                    <span>Set Timezone:</span>
                    <select id="gmt-select">
                        <option value="-12">GMT-12</option>
                        <option value="-11">GMT-11</option>
                        <option value="-10">GMT-10</option>
                        <option value="-9">GMT-9</option>
                        <option value="-8">GMT-8</option>
                        <option value="-7">GMT-7</option>
                        <option value="-6">GMT-6</option>
                        <option value="-5">GMT-5</option>
                        <option value="-4">GMT-4</option>
                        <option value="-3">GMT-3</option>
                        <option value="-2">GMT-2</option>
                        <option value="-1">GMT-1</option>
                        <option value="0">GMT±0</option>
                        <option value="1">GMT+1</option>
                        <option value="2">GMT+2</option>
                        <option value="3">GMT+3</option>
                        <option value="4">GMT+4</option>
                        <option value="5">GMT+5</option>
                        <option value="6" selected>GMT+6 (Bangladesh)</option>
                        <option value="7">GMT+7</option>
                        <option value="8">GMT+8</option>
                        <option value="9">GMT+9</option>
                        <option value="10">GMT+10</option>
                        <option value="11">GMT+11</option>
                        <option value="12">GMT+12</option>
                    </select>
                </div>
            </div>
            
            <div class="timer-box">
                <h3>Study Timer</h3>
                <div class="timer-display" id="timer-display">00:00:00</div>
                <div class="timer-controls">
                    <button class="timer-btn" id="start-timer">Start</button>
                    <button class="timer-btn" id="pause-timer">Pause</button>
                    <button class="timer-btn" id="reset-timer">Reset</button>
                </div>
            </div>
        </div>
        
        <div class="routine-section">
            <div class="routine-title" draggable="true">
                <h2 contenteditable="true">🔥🔥সকাল ১০টা পর্যন্ত : No Screen</h2>
                <button class="edit-btn" onclick="toggleEditMode('morning')">Edit</button>
            </div>
            <ul class="task-list" id="morning-tasks">
                <li class="task-item" draggable="true">
                    <input type="checkbox" class="task-checkbox">
                    <span class="task-text">নামাজ: ফজর</span>
                </li>
                <li class="task-item" draggable="true">
                    <input type="checkbox" class="task-checkbox">
                    <span class="task-text">Biology (Self Study)</span>
                </li>
                <li class="task-item" draggable="true">
                    <input type="checkbox" class="task-checkbox">
                    <span class="task-text">1. Read Book and try মুখস্ত</span>
                </li>
                <li class="task-item" draggable="true">
                    <input type="checkbox" class="task-checkbox">
                    <span class="task-text">2. QB Solve (অ্যাসপেক্ট) and try মুখস্ত</span>
                </li>
            </ul>
            <div class="edit-controls" id="morning-edit-controls" style="display: none;">
                <button class="add-task-btn" onclick="addTask('morning')">Add Task</button>
                <button class="cancel-btn" onclick="toggleEditMode('morning')">Cancel</button>
                <button class="save-btn" onclick="saveTasks('morning')">Save</button>
            </div>
        </div>
        
        <div class="routine-section">
            <div class="routine-title" draggable="true">
                <h2 contenteditable="true">🔥🔥সকাল ১০ টা থেকে ১১:৩০ পর্যন্ত</h2>
                <button class="edit-btn" onclick="toggleEditMode('late-morning')">Edit</button>
            </div>
            <ul class="task-list" id="late-morning-tasks">
                <li class="task-item" draggable="true">
                    <input type="checkbox" class="task-checkbox">
                    <span class="task-text">Physics Hunter Online Class</span>
                </li>
                <li class="task-item" draggable="true">
                    <input type="checkbox" class="task-checkbox">
                    <span class="task-text">1. Make Own Note</span>
                </li>
                <li class="task-item" draggable="true">
                    <input type="checkbox" class="task-checkbox">
                    <span class="task-text">নামাজ: যোহর</span>
                </li>
            </ul>
            <div class="edit-controls" id="late-morning-edit-controls" style="display: none;">
                <button class="add-task-btn" onclick="addTask('late-morning')">Add Task</button>
                <button class="cancel-btn" onclick="toggleEditMode('late-morning')">Cancel</button>
                <button class="save-btn" onclick="saveTasks('late-morning')">Save</button>
            </div>
        </div>
        
        <div class="routine-section">
            <div class="routine-title" draggable="true">
                <h2 contenteditable="true">🔥🔥দুপুর ৩:৩০ থেকে ৬:৩০ পর্যন্ত</h2>
                <button class="edit-btn" onclick="toggleEditMode('afternoon')">Edit</button>
            </div>
            <ul class="task-list" id="afternoon-tasks">
                <li class="task-item" draggable="true">
                    <input type="checkbox" class="task-checkbox">
                    <span class="task-text">নামাজ: আসর</span>
                </li>
                <li class="task-item" draggable="true">
                    <input type="checkbox" class="task-checkbox">
                    <span class="task-text">Physics Hunter: (Material)</span>
                </li>
                <li class="task-item" draggable="true">
                    <input type="checkbox" class="task-checkbox">
                    <span class="task-text">1. Class PDF</span>
                </li>
                <li class="task-item" draggable="true">
                    <input type="checkbox" class="task-checkbox">
                    <span class="task-text">2. Own Note</span>
                </li>
                <li class="task-item" draggable="true">
                    <input type="checkbox" class="task-checkbox">
                    <span class="task-text">3. QB Solve (অ্যাসপেক্ট)</span>
                </li>
                <li class="task-item" draggable="true">
                    <input type="checkbox" class="task-checkbox">
                    <span class="task-text">নামাজ: মাগরিব</span>
                </li>
            </ul>
            <div class="edit-controls" id="afternoon-edit-controls" style="display: none;">
                <button class="add-task-btn" onclick="addTask('afternoon')">Add Task</button>
                <button class="cancel-btn" onclick="toggleEditMode('afternoon')">Cancel</button>
                <button class="save-btn" onclick="saveTasks('afternoon')">Save</button>
            </div>
        </div>
        
        <div class="routine-section">
            <div class="routine-title" draggable="true">
                <h2 contenteditable="true">🔥🔥রাত ৭টা থেকে ৯:৩০টা</h2>
                <button class="edit-btn" onclick="toggleEditMode('evening')">Edit</button>
            </div>
            <ul class="task-list" id="evening-tasks">
                <li class="task-item" draggable="true">
                    <input type="checkbox" class="task-checkbox">
                    <span class="task-text">Chemistry (Milton vai) Class</span>
                </li>
                <li class="task-item" draggable="true">
                    <input type="checkbox" class="task-checkbox">
                    <span class="task-text">1. Make Note</span>
                </li>
                <li class="task-item" draggable="true">
                    <input type="checkbox" class="task-checkbox">
                    <span class="task-text">2. Read Note and try মুখস্ত</span>
                </li>
                <li class="task-item" draggable="true">
                    <input type="checkbox" class="task-checkbox">
                    <span class="task-text">নামাজ: এশা</span>
                </li>
            </ul>
            <div class="edit-controls" id="evening-edit-controls" style="display: none;">
                <button class="add-task-btn" onclick="addTask('evening')">Add Task</button>
                <button class="cancel-btn" onclick="toggleEditMode('evening')">Cancel</button>
                <button class="save-btn" onclick="saveTasks('evening')">Save</button>
            </div>
        </div>
        
        <div class="routine-section">
            <div class="routine-title" draggable="true">
                <h2 contenteditable="true">🔥🔥রাত ১০টা থেকে ১টা পর্যন্ত : No Screen</h2>
                <button class="edit-btn" onclick="toggleEditMode('night')">Edit</button>
            </div>
            <ul class="task-list" id="night-tasks">
                <li class="task-item" draggable="true">
                    <input type="checkbox" class="task-checkbox">
                    <span class="task-text">Chemistry (Self Study)</span>
                </li>
                <li class="task-item" draggable="true">
                    <input type="checkbox" class="task-checkbox">
                    <span class="task-text">1. Read Book</span>
                </li>
                <li class="task-item" draggable="true">
                    <input type="checkbox" class="task-checkbox">
                    <span class="task-text">2. Read Class Note (Milton), Own</span>
                </li>
                <li class="task-item" draggable="true">
                    <input type="checkbox" class="task-checkbox">
                    <span class="task-text">3. QB Solve (অ্যাসপেক্ট)</span>
                </li>
            </ul>
            <div class="edit-controls" id="night-edit-controls" style="display: none;">
                <button class="add-task-btn" onclick="addTask('night')">Add Task</button>
                <button class="cancel-btn" onclick="toggleEditMode('night')">Cancel</button>
                <button class="save-btn" onclick="saveTasks('night')">Save</button>
            </div>
        </div>
        
        <div class="routine-section">
            <div class="routine-title" draggable="true">
                <h2 contenteditable="true">Other Activities</h2>
                <button class="edit-btn" onclick="toggleEditMode('other')">Edit</button>
            </div>
            <ul class="task-list" id="other-tasks">
                <li class="task-item" draggable="true">
                    <input type="checkbox" class="task-checkbox">
                    <span class="task-text">সকাল ১১:৩০ এর পর এবং রাত ৯:৩০ এর পর নিউজপেপার (Web/Telegram)</span>
                </li>
            </ul>
            <div class="edit-controls" id="other-edit-controls" style="display: none;">
                <button class="add-task-btn" onclick="addTask('other')">Add Task</button>
                <button class="cancel-btn" onclick="toggleEditMode('other')">Cancel</button>
                <button class="save-btn" onclick="saveTasks('other')">Save</button>
            </div>
        </div>
        
        <div class="exam-section" contenteditable="true">
            <h3>Exam Schedule</h3>
            <p><strong>Own Exam:</strong> বরিার, মঙ্গলবার, বৃহস্পতিবার। self study এর টাইমে, এই বিষয়ের উপর শনি, সোম, বুধ বারে পড়ার উপর তিরিশ মার্কের ২৫ মিনিটের এক্সাম।</p>
            <p>এভাবে শনি, সোম,বুধ বারে বরিার, মঙ্গলবার, বৃহস্পতিবারের পড়ার উপর exam</p>
        </div>
        
        <footer>
            <p>© 2023 My Study Routine | Stay focused and achieve your goals</p>
        </footer>
    </div>

    <!-- PDF Export Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <script>
        // Dark Mode Toggle
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        darkModeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
            updateDarkModeButton();
        });

        function updateDarkModeButton() {
            if (document.body.classList.contains('dark-mode')) {
                darkModeToggle.textContent = '☀️ Light Mode';
            } else {
                darkModeToggle.textContent = '🌙 Dark Mode';
            }
        }

        // Check for saved dark mode preference
        if (localStorage.getItem('darkMode') === 'true') {
            document.body.classList.add('dark-mode');
            updateDarkModeButton();
        }

        // Update current time and date with location detection
        function updateDateTime() {
            const now = new Date();
            
            // Format time in 12-hour format with AM/PM
            let hours = now.getHours();
            const ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12;
            hours = hours ? hours : 12; // Convert 0 to 12
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            
            const timeString = `${hours}:${minutes}:${seconds} ${ampm}`;
            
            // Format date
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const dateString = now.toLocaleDateString('en-US', options);
            
            document.getElementById('current-time').textContent = timeString;
            document.getElementById('current-date').textContent = dateString;
        }
        
        // Try to get location
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        // Reverse geocoding to get city name would require an API
                        // For simplicity, we'll just show coordinates
                        document.getElementById('location-info').textContent = 
                            `Location: ${position.coords.latitude.toFixed(2)}°, ${position.coords.longitude.toFixed(2)}°`;
                        document.getElementById('gmt-control').style.display = 'none';
                    },
                    (error) => {
                        console.error("Error getting location:", error);
                        document.getElementById('location-info').textContent = "Location: Not available (using GMT+6)";
                        document.getElementById('gmt-control').style.display = 'flex';
                    }
                );
            } else {
                document.getElementById('location-info').textContent = "Location: Not supported (using GMT+6)";
                document.getElementById('gmt-control').style.display = 'flex';
            }
        }

        // Update every second
        setInterval(updateDateTime, 1000);
        updateDateTime(); // Initial call
        getLocation(); // Try to get location

        // GMT offset selection
        const gmtSelect = document.getElementById('gmt-select');
        gmtSelect.addEventListener('change', () => {
            // In a real implementation, you would adjust the displayed time
            document.getElementById('location-info').textContent = 
                `Location: Manual (GMT${gmtSelect.value > 0 ? '+' : ''}${gmtSelect.value})`;
        });

        // Timer functionality
        let timerInterval;
        let timerSeconds = 0;
        let isTimerRunning = false;
        
        function updateTimerDisplay() {
            const hours = Math.floor(timerSeconds / 3600);
            const minutes = Math.floor((timerSeconds % 3600) / 60);
            const seconds = timerSeconds % 60;
            
            const displayString = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            document.getElementById('timer-display').textContent = displayString;
        }
        
        function startTimer() {
            if (!isTimerRunning) {
                isTimerRunning = true;
                timerInterval = setInterval(() => {
                    timerSeconds++;
                    updateTimerDisplay();
                }, 1000);
            }
        }
        
        function pauseTimer() {
            clearInterval(timerInterval);
            isTimerRunning = false;
        }
        
        function resetTimer() {
            pauseTimer();
            timerSeconds = 0;
            updateTimerDisplay();
        }
        
        document.getElementById('start-timer').addEventListener('click', startTimer);
        document.getElementById('pause-timer').addEventListener('click', pauseTimer);
        document.getElementById('reset-timer').addEventListener('click', resetTimer);
        
        // Progress Tracker
        function updateProgress() {
            const totalTasks = document.querySelectorAll('.task-checkbox').length;
            const completedTasks = document.querySelectorAll('.task-checkbox:checked').length;
            const percentage = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            
            document.getElementById('progress-text').textContent = 
                `${percentage}% Completed (${completedTasks}/${totalTasks} Tasks)`;
            document.getElementById('progress-bar').style.width = `${percentage}%`;
        }
        
        // Update progress when checkboxes change
        document.addEventListener('change', (e) => {
            if (e.target.classList.contains('task-checkbox')) {
                updateProgress();
                saveCheckboxState();
            }
        });
        
        // Checklist functionality
        function saveCheckboxState() {
            const checkboxes = document.querySelectorAll('.task-checkbox');
            const checkboxStates = {};
            
            checkboxes.forEach((checkbox, index) => {
                checkboxStates[`checkbox-${index}`] = checkbox.checked;
            });
            
            localStorage.setItem('checkboxStates', JSON.stringify(checkboxStates));
        }
        
        function loadCheckboxState() {
            const savedStates = localStorage.getItem('checkboxStates');
            if (savedStates) {
                const checkboxStates = JSON.parse(savedStates);
                
                document.querySelectorAll('.task-checkbox').forEach((checkbox, index) => {
                    const key = `checkbox-${index}`;
                    if (checkboxStates.hasOwnProperty(key)) {
                        checkbox.checked = checkboxStates[key];
                        if (checkbox.checked) {
                            checkbox.parentElement.classList.add('completed');
                        }
                    }
                });
                updateProgress();
            }
        }
        
        // Drag and Drop functionality
        function setupDragAndDrop() {
            const draggables = document.querySelectorAll('[draggable="true"]');
            const containers = document.querySelectorAll('.task-list, .container');
            
            draggables.forEach(draggable => {
                draggable.addEventListener('dragstart', () => {
                    draggable.classList.add('dragging');
                });
                
                draggable.addEventListener('dragend', () => {
                    draggable.classList.remove('dragging');
                    saveTasksState();
                });
            });
            
            containers.forEach(container => {
                container.addEventListener('dragover', e => {
                    e.preventDefault();
                    const afterElement = getDragAfterElement(container, e.clientY);
                    const draggable = document.querySelector('.dragging');
                    
                    if (afterElement == null) {
                        container.appendChild(draggable);
                    } else {
                        container.insertBefore(draggable, afterElement);
                    }
                });
            });
        }
        
        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('[draggable="true"]:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }
        
        function saveTasksState() {
            const sections = ['morning', 'late-morning', 'afternoon', 'evening', 'night', 'other'];
            const tasksState = {};
            
            sections.forEach(section => {
                const tasks = [];
                document.querySelectorAll(`#${section}-tasks .task-text`).forEach(task => {
                    tasks.push(task.textContent);
                });
                tasksState[section] = tasks;
            });
            
            localStorage.setItem('tasksState', JSON.stringify(tasksState));
        }
        
        // Edit mode functionality
        function toggleEditMode(section) {
            const taskList = document.getElementById(`${section}-tasks`);
            const editControls = document.getElementById(`${section}-edit-controls`);
            
            if (taskList.classList.contains('edit-mode')) {
                // Exit edit mode
                taskList.classList.remove('edit-mode');
                editControls.style.display = 'none';
                
                // Convert back to regular task items
                const taskInputs = taskList.querySelectorAll('input[type="text"]');
                taskInputs.forEach(input => {
                    const value = input.value;
                    const li = input.parentElement;
                    li.innerHTML = `
                        <input type="checkbox" class="task-checkbox">
                        <span class="task-text">${value}</span>
                        <button class="delete-task-btn" onclick="deleteTask(this)">Delete</button>
                    `;
                    
                    // Reattach event listeners
                    li.querySelector('.task-checkbox').addEventListener('change', function() {
                        if (this.checked) {
                            li.classList.add('completed');
                        } else {
                            li.classList.remove('completed');
                        }
                        saveCheckboxState();
                        updateProgress();
                    });
                    
                    // Make draggable
                    li.setAttribute('draggable', 'true');
                    li.addEventListener('dragstart', () => {
                        li.classList.add('dragging');
                    });
                    li.addEventListener('dragend', () => {
                        li.classList.remove('dragging');
                        saveTasksState();
                    });
                });
            } else {
                // Enter edit mode
                taskList.classList.add('edit-mode');
                editControls.style.display = 'flex';
                
                // Convert to editable task items
                const tasks = taskList.querySelectorAll('.task-item');
                tasks.forEach(task => {
                    const text = task.querySelector('.task-text').textContent;
                    task.innerHTML = `
                        <input type="text" class="task-text" value="${text}">
                        <button class="delete-task-btn" onclick="deleteTask(this)">Delete</button>
                    `;
                });
            }
        }
        
        function addTask(section) {
            const taskList = document.getElementById(`${section}-tasks`);
            const newTask = document.createElement('li');
            newTask.className = 'task-item';
            newTask.setAttribute('draggable', 'true');
            newTask.innerHTML = `
                <input type="text" class="task-text" placeholder="Enter new task">
                <button class="delete-task-btn" onclick="deleteTask(this)">Delete</button>
            `;
            taskList.appendChild(newTask);
        }
        
        function deleteTask(button) {
            const taskItem = button.parentElement;
            taskItem.remove();
            updateProgress();
            saveTasksState();
        }
        
        function saveTasks(section) {
            const taskList = document.getElementById(`${section}-tasks`);
            const taskInputs = taskList.querySelectorAll('input[type="text"]');
            
            // Exit edit mode
            taskList.classList.remove('edit-mode');
            document.getElementById(`${section}-edit-controls`).style.display = 'none';
            
            // Clear existing tasks
            taskList.innerHTML = '';
            
            // Create new task items from inputs
            taskInputs.forEach(input => {
                if (input.value.trim() !== '') {
                    const newTask = document.createElement('li');
                    newTask.className = 'task-item';
                    newTask.setAttribute('draggable', 'true');
                    newTask.innerHTML = `
                        <input type="checkbox" class="task-checkbox">
                        <span class="task-text">${input.value}</span>
                    `;
                    taskList.appendChild(newTask);
                    
                    // Add event listener to new checkbox
                    newTask.querySelector('.task-checkbox').addEventListener('change', function() {
                        if (this.checked) {
                            newTask.classList.add('completed');
                        } else {
                            newTask.classList.remove('completed');
                        }
                        saveCheckboxState();
                        updateProgress();
                    });
                    
                    // Setup drag events
                    newTask.addEventListener('dragstart', () => {
                        newTask.classList.add('dragging');
                    });
                    newTask.addEventListener('dragend', () => {
                        newTask.classList.remove('dragging');
                        saveTasksState();
                    });
                }
            });
            
            saveTasksState();
            updateProgress();
        }
        
        // PDF Export
        document.getElementById('export-pdf').addEventListener('click', () => {
            const element = document.querySelector('.container');
            const opt = {
                margin: 10,
                filename: 'study-routine.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            
            // Temporarily hide edit buttons for PDF export
            const editButtons = document.querySelectorAll('.edit-btn');
            editButtons.forEach(btn => btn.style.visibility = 'hidden');
            
            html2pdf().from(element).set(opt).save().then(() => {
                // Restore edit buttons after export
                editButtons.forEach(btn => btn.style.visibility = 'visible');
            });
        });
        
        // Load saved data when page loads
        window.addEventListener('load', () => {
            loadCheckboxState();
            setupDragAndDrop();
            
            // Load editable titles
            const editableTitles = document.querySelectorAll('[contenteditable="true"]');
            editableTitles.forEach(title => {
                title.addEventListener('blur', () => {
                    localStorage.setItem(`title-${title.parentElement.parentElement.id}`, title.textContent);
                });
                
                const savedTitle = localStorage.getItem(`title-${title.parentElement.parentElement.id}`);
                if (savedTitle) {
                    title.textContent = savedTitle;
                }
            });
            
            // Load exam schedule
            const examSection = document.querySelector('.exam-section');
            const savedExam = localStorage.getItem('exam-content');
            if (savedExam) {
                examSection.innerHTML = savedExam;
            }
            
            examSection.addEventListener('blur', () => {
                localStorage.setItem('exam-content', examSection.innerHTML);
            });
        });
    </script>
</body>
</html>
